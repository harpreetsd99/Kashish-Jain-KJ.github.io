<!DOCTYPE html>
<html>
<head>
	<title>Post Product</title>
	<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link rel="icon" type="image" href="img/adminpost.png">
	<link rel="stylesheet" type="text/css" href="adminpost.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/css2?family=MuseoModerno:wght@500&family=Roboto&display=swap" rel="stylesheet">
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="crossorigin="anonymous"></script>

</head>
<body>
	<div class="navbar-fixed">
		<nav class="navbar">
			<div class="nav-wrapper">
			   	<a href="#" id="logo" class="brand-logo orange-text">ADMIN</a>
			   	 <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
			   	<ul id="nav-mobile" class="right hide-on-med-and-down">
			   		<li><a href="./DashBoard.html">DashBoard</a></li>
					   <li><a href="./ViewProducts.html">View Products</a></li>
					   <li><a href="./adminpost.html">Add Products</a></li>
			      
			    </ul>
			   
				
				
			</div>
		</nav>
	</div>
	<ul class="sidenav" id="mobile-demo">
		<li><a href="./DashBoard.html">DashBoard</a></li>
		<li><a href="./ViewProducts.html">View Products</a></li>
		<li><a href="./adminpost.html">Add Products</a></li>
	</ul>
	<main class="main" style="display: block;">
		<div class="form">
			<h3 class="add-title center orange-text">UPDATE PRODUCT<hr width="100px"></h3>
			<div class="row">
	   			<form class="col s12">
	   				<div class="row">
	   					<div class="input-field col s12 m3">
						    <select id="select" required>
						      <option value="" disabled selected>Choosed</option>
						      <option value="Veggies" id="Veggies">Veggies</option>
						      <option value="Fruits"id="Fruits">Fruits</option>
						      <option value="Others" id="Others">Others</option>
						    </select>
						    <label for="select">Select Category</label>
						</div>
	   					<div class="input-field col s12 m3">
				            <input id="product" placeholder="Product Name" type="text" class="validate" required>
						    <label for="product">Product Name</label>
				        </div>
				        <div class="input-field col s4 m2">
	        				<input placeholder="Qty" id="qty" type="text" class="validate" required>
	          				<label for="qty">Quantity</label>
	        			</div>
	        			<div class="input-field col s4 m2">
	        				<input placeholder="kg/gm" id="unit" type="text" class="validate" required>
	          				<label for="unit">Unit</label>
	        			</div>
	        			<div class="input-field col s4 m2">
	        				<input id="price" placeholder="Rupees" type="text" class="validate" required>
	          				<label for="price">Price</label>
	        			</div>
	        		</div>
	        		<div class="row">
	        			<div class="input-field col s12 m3">
					        <div class="file-field input-field" style="margin:0px;padding: 0px;">
						    	<div class="btn-large waves-effect waves-light">	
									<span>Image</span>
						        	<input type="file" id="files" onchange="readURL(this);">	
						      	</div>
						      	<div class=" col s2 m1">
									<img id="img1"  height="50px" width = "50px" style="padding:0px 1px 5px 0px;"/>
								</div>
						    </div>
						</div>
						<div class="input-field col s12 m9">
							<textarea id="textarea1" class="materialize-textarea" required></textarea>
							<label for="textarea1">Description</label>
						</div>
					<!-- 
						<div class="input-field col s6 m3">
	        				<input id="checkpoint" placeholder="No. Of Checkpoints" type="number" class="validate" min="0" required>
	          				<label for="checkpoint">Check-Points</label>
	        			</div>
	        		---->
					</div>
					<!--
					 <script type="text/javascript">
					 	$( document ).ready(function(){

						 	$("#checkpoint").on("input",function(){
						 		if( $("#checkpoint").val() > 0 ){
						 			$(".checkpoints1").show("slow");
						 			$(".checkpoints2").show("slow");
						 			$(".checkpoints3").show("slow");
						 			$(".checkpoints4").show("slow");
						 			$(".checkpoints5").show("slow");
						 			$(".form").css("height","auto");
						 		}else if( $("#checkpoint").val() == 0 ){
						 			$(".checkpoints1").hide("fast");
						 			$(".checkpoints2").hide("fast");
						 			$(".checkpoints3").hide("fast");
						 			$(".checkpoints4").hide("fast");
						 			$(".checkpoints5").hide("fast");
						 			$(".form").css("height","auto");
						 		}
						 	});

						});
					</script>
				-->
<!----------------------------------Checkpoints(5 Hard-Coded)---------------------------->
	        		<div class="row">
	        			<div class="checkpoints1">
		        			<h6 class="center">Check-Point 1<hr width="50px"></h6><br>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input placeholder="Qty Required" id="qty-req1" type="text" class="validate">
		          				<label for="qty-req1">Quantity-1</label>
		        			</div>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input id="price-point1" placeholder="Price After Point" type="text" class="validate">
		          				<label for="price-point1">Price-1</label>
		        			</div>
		        		</div>
	        		</div>
	        		<div class="row">
	        			<div class="checkpoints2">
		        			<h6 class="center">Check-Point 2<hr width="50px"></h6><br>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input placeholder="Qty Required" id="qty-req2" type="text" class="validate">
		          				<label for="qty-req2">Quantity-2</label>
		        			</div>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input id="price-point2" placeholder="Price After Point" type="text" class="validate">
		          				<label for="price-point2">Price-2</label>
		        			</div>
		        		</div>
	        		</div>
	        		<div class="row">
	        			<div class="checkpoints3">
		        			<h6 class="center">Check-Point 2<hr width="50px"></h6><br>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input placeholder="Qty Required" id="qty-req3" type="text" class="validate">
		          				<label for="qty-req3">Quantity-3</label>
		        			</div>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input id="price-point3" placeholder="Price After Point" type="text" class="validate">
		          				<label for="price-point3">Price-3</label>
		        			</div>
		        		</div>
	        		</div>
	        		<div class="row">
	        			<div class="checkpoints4">
		        			<h6 class="center">Check-Point 4<hr width="50px"></h6><br>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input placeholder="Qty Required" id="qty-req4" type="text" class="validate">
		          				<label for="qty-req4">Quantity-4</label>
		        			</div>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input id="price-point4" placeholder="Price After Point" type="text" class="validate">
		          				<label for="price-point4">Price-4</label>
		        			</div>
		        		</div>
	        		</div>
	        		<div class="row">
	        			<div class="checkpoints2">
		        			<h6 class="center">Check-Point 5<hr width="50px"></h6><br>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input placeholder="Qty Required" id="qty-req5" type="text" class="validate">
		          				<label for="qty-req5">Quantity-5</label>
		        			</div>
		        			<div class="input-field col s6 m3 offset-m2">
		        				<input id="price-point5" placeholder="Price After Point" type="text" class="validate">
		          				<label for="price-point5">Price-5</label>
		        			</div>
		        		</div>
	        		</div>
	        		<div class="row">
	        			<h6 class="center">Validation<hr width="50px"></h6><br>
	        			<div class="input-field col s12 m4 offset-m2">
							<input id="end-date" type="text" class="datepicker" placeholder="End-Date For Checkpoints">
						</div>
						<div class="input-field col s10 m4 offset-m1">
							<p>
						      <label>
						        <input type="checkbox" id="checkbox-show"/>
						        <span>Display This Product</span>
						      </label>
						    </p>
						</div>
					</div><br>
<!-----------------------------------------Checkpoints-End------------------------------>
	        		<div class="row">
	        			<div class="center">
							<button id="preview" class="btn-large waves-effect waves-light " style="border-radius: 10px;background-color:#1c2224;">Preview</button><br><label>Proceed To Next Step</label>
						</div><br>
	        		</div>
	        		<script type="text/javascript">
					 	$( document ).ready(function(){
						 	$("#preview").on("click",function(e){
						 		e.preventDefault();
						 		$(".main").hide();
						 		$(".preview").show();
						 		$("body").css("background-color","#ffffff");
								$("html").css("background-color","#ffffff");

								
								document.getElementById("product2").innerHTML= document.getElementById("product").value;
								document.getElementById("textarea2").innerHTML= document.getElementById("textarea1").value;
								document.getElementById("qty2").innerHTML= document.getElementById("qty").value;
								document.getElementById("unit2").innerHTML= document.getElementById("unit").value;


								document.getElementById("price2").innerHTML= document.getElementById("price").value;


								// document.getElementById("textarea2").innerHTML= document.getElementById("textarea1").value;
								
								// $("#qty2").val($("#qty").val());
								// $("#unit2").val($("#unit").val());
								// $("#price2").val($("#price").val());
								// $("#textarea2").val($("#textarea1").val());
							$("#checkpoint").empty();
							$("#cpqty").empty();
							$("#cpprice").empty();
								
							var count = 0;
								if(document.getElementById("qty-req5").value != ""){
									count=5;
								}else if(document.getElementById("qty-req4").value != ""){
									count=4;
								}else if(document.getElementById("qty-req3").value != ""){
									count=3;
								}else if(document.getElementById("qty-req2").value != ""){
									count=2;
								}else if(document.getElementById("qty-req1").value != ""){
									count=1;
								}else{
									count=0;
								}
								if (count>0) {
						            $("checkpoint-details").show();
						            var quantity = parseInt($("#qty").val());
						            console.log(quantity);
						            var x=0;
						            for(var i=1;i<=count;i++){
						                var a = "qty-req" + i.toString();
						                var b = "price-point" + i.toString();
						                var c = (parseInt(document.getElementById(a).value)/quantity) *100;
						                $("#checkpoint").append(
						                    `<div class = "cp" style=" min-width:${c-x}%;"><i class="fa fa-location-arrow fa-rotate-90 " style="color:orange;" ></i></div><!--`
						                );
						                $("#cpqty").append(
						                    `<div class = "cp" style=" min-width:${c-x}%;">
						                    ${document.getElementById(a).value}
						                    </div><!--`
						                );
						                $("#cpprice").append(
						                    `<div class = "cp" style=" min-width:${c-x}%;">&#8377;${document.getElementById(b).value}</div><!--`
						                );
						                x =c;
						            }
						            }else{
						            $("#checkpoint-details").hide();
						        }
							});
						});
					 </script>
	        	</form>
	        </div>	
	    </div>
	</main>
	<div class="preview align-self-center" style="display: none;">
		<div class="row">
			<div id="product-img-cont" class="col s12 m6">
				<div class="product-image">
					<img id="img" class="materialboxed" src="img/pineapple.jpg" width="500px" height="500px" alt="product-img"/>
				</div>
				<script type="text/javascript">
                    function readURL(input) {
						console.log("ho raha hai");
                        if (input.files && input.files[0]) {
                            var reader = new FileReader();
							 reader.onload = function (e) {
								$('#img1')
                                        .attr('src', e.target.result)
                                        .width(45)
										.height(45);
                                $('#img')
                                    .attr('src', e.target.result)
                                };
							reader.readAsDataURL(input.files[0]);
                        }
                    }
                </script>
			</div>
			<div class="col s12 m6">
				<div class="product-details">
					<div class="row">
						<div class="title">	
								<h1 class="title-main" id = "product2"> </h1> <a href="#"><i class="small material-icons black-text darken-1">share</i></a> 
								<hr id="hr">
						</div>
						<script type="text/javascript">
						    $( document ).ready(function(){
						    	$("#product").keyup(function(){
									$(".title-main").text($(this).val());
								});
						    });
						</script>
					</div>
					<div class="row">
						<div class="mrp">
							<s><span class="product-mrp">Product Mrp :&emsp;</span></s>
							<s><span id="price3" class="product-mrp">0&#8377;</span></s>
							<button class="offer">0% OFF</button>
						</div>
					</div>
					<div class="row">
						<div class="selling-price">
							<span class="selling-price"><strong>Selling Price :</strong></span>
							<span id="price2" class="selling-price"><strong>&emsp;0&#8377;</strong></span><br>
							<label>(Inclusive of all taxes)</label>
						</div>
						<script type="text/javascript">
						    $( document ).ready(function(){
						    	$("#price").keyup(function(){
								  $("#price2").text($(this).val());
								  $("#price3").text($(this).val());
								});
						    });
						</script>
					</div>
					<div class="row">
						<div class="description">
							<h6>Product Details:</h6>
							<label id="textarea2" >Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
							tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
							quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
							</label>
						</div>
						<script type="text/javascript">
						    $( document ).ready(function(){
						    	$("#textarea1").keyup(function(){
								  $("#textarea2").text($(this).val());
								});
						   	});
						</script>
					</div>
					<div class="row">
						<div class="qty-sold">
							<p>
								<h6 style="font-size:15px;font-family: 'Roboto', sans-serif;">Available Qty:&emsp;
							   		<span id="qty2">0</span>&emsp;<span id="unit2">Units</span>
							   		<script type="text/javascript">
						    			$( document ).ready(function(){
						    				$("#qty").keyup(function(){
									  			$("#qty2").text($(this).val());
									  		$("#unit").keyup(function(){
									  			$("#unit2").text($(this).val());
											});
										});
						    		});
						    		</script>
									<span style="margin-left: 50px;">
										<button id="count-dsc" class="waves-effect waves-light btn">
											-
										</button>
										&emsp;<span id="count">1</span>&emsp;
										<button id="count-inc" class="waves-effect waves-light btn">
											+
										</button>
									</span>
							    </h6>
							</p>
							<script type="text/javascript">
								$(document).ready(function(){
									$("#count-inc").on("click",function(){
										var count = $("#count").text();
										count++;
										$("#count").text(count);
									});
									$("#count-dsc").on("click",function(){
										var count = $("#count").text();
										count--;
										if (count >= 0) {
											$("#count").text(count);
										}
									});
								});
							</script>
						</div>
					</div>
					<div class="row">
						<p><span>No. Of Units Sold:&emsp;5 Units</span></p>
					</div>
					<div id="checkpoint-details" class="row" >
						<div  id= "checkpoint" style="width: 100%;"></div>
						<div id="progress-bar" class="progress" style="margin-top: 0px;">
	      					<div class="determinate" id="bar" style="background-color: #ff8c00; width: 20%;"></div>
	  						</div>
						<div id="cpqty"  style="width: 100%; margin-top: 10px;"></div>
						<div id= "cpprice"  style="width: 100%; margin-top: 0px;"></div><br>
					</div>
					<div class="row">
						<div class="btns center">
							<a id="btn-main" class="waves-effect waves-light btn orange darken-1"><i class="material-icons right">shopping_basket</i>Add To Cart</a>
							<a id="btn-main" class="waves-effect waves-light btn orange darken-1"><i class="material-icons right">credit_card</i>Check-Out</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row" style="padding-top: 40px;">
		    <div class="center">
				<a href="#" id="edit" class="waves-effect waves-light btn" style="border-radius: 10px;background-color: #1c2224;">Edit Details</a>
				<a href="#" id="submit" class="waves-effect waves-light btn" type="submit" style="border-radius: 10px;background-color:#1c2224;margin-left: 10px;">Submit Product</a>
			</div>
		</div>
		<script type="text/javascript">
			$( document ).ready(function(){
				$("#edit").on("click",function(e){
					e.preventDefault();
					$(".main").show();
					$(".preview").hide();
					$("body").css("background-color","#f4e4a9");
					$("html").css("background-color","#f4e4a9");
				});
			});
			$( document ).ready(function(){
						 	$("#submit").on("click",function(e){
								e.preventDefault();
								const db = firebase.firestore();

								var storageRef = firebase.storage().ref();
								var Pname = document.getElementById("product").value;
								var file = document.querySelector("#files").files[0];
								var checkvalue;
								if ($('#checkbox-show').is(":checked"))
									{
									  checkvalue = 1;
									}else{
									  checkvalue=0;
									}
								if(typeof file == "undefined"){
									var docRef = db.collection("Products").doc(localStorage.getItem("Productsss"));
										
										docRef.get().then(function(doc)	{
											var image = doc.data().Product_Img;
											var img_url = doc.data().Product_URL;
											db.collection("Products").doc(Pname.replace(/\s/g,'')).set({
        								Product_Name: document.getElementById("product").value,
        								Product_Category:  document.getElementById("select").value,
        								Product_Discription: document.getElementById("textarea1").value,
        								Product_Quantity:  document.getElementById("qty").value,
										Product_Unit: document.getElementById("unit").value,
										Product_Price: document.getElementById("price").value,
										Product_Img: image,
										CheckPointQuantity1: document.getElementById("qty-req1").value,
										CheckPointPrice1: document.getElementById("price-point1").value,
										CheckPointQuantity2: document.getElementById("qty-req2").value,
										CheckPointPrice2: document.getElementById("price-point2").value,
										CheckPointQuantity3: document.getElementById("qty-req3").value,
										CheckPointPrice3: document.getElementById("price-point3").value,
										CheckPointQuantity4: document.getElementById("qty-req4").value,
										CheckPointPrice4: document.getElementById("price-point4").value,
										CheckPointQuantity5: document.getElementById("qty-req5").value,
										CheckPointPrice5: document.getElementById("price-point5").value,
										Product_URL: img_url,
										End_Date:$('#end-date').val(),
        						    	Checkbox_Show: checkvalue

    								})
    								.then(function() {
									alert("Document successfully written!");
									$(".main").show();
						 			$(".preview").hide();
									$("body").css("background-color","#f4e4a9");
									window.location.href = "ViewProducts.html"
									
    								})
    								.catch(function(error) {
        							alert("Error writing document: ");
								
									});
									if(Pname.replace(/\s/g,'') != localStorage.getItem("Productsss")){
										db.collection("Products").doc(localStorage.getItem("Productsss")).delete().then(function() {
    										console.log("Document successfully deleted!");
										}).catch(function(error) {
    										console.error("Error removing document: ", error);
										});
										
									}

										});
									
									
									console.log("file is undefined");
								}
								else{
									console.log(file);	
									const name =  new Date() + file.name;
								var mountainsRef = storageRef.child(name);
								var metadata = {
									contentType: file.type
								}
								var uploadTask = storageRef.child('images/' + name).put(file, metadata);
					
						{ 
         
  
     
  
        
          uploadTask.on('state_changed', function(snapshot){ 
            var progress =  
             (snapshot.bytesTransferred / snapshot.totalBytes) * 100; 
            
              switch (snapshot.state) { 
                case firebase.storage.TaskState.PAUSED: 
                  console.log('Upload is paused'); 
                  break; 
                case firebase.storage.TaskState.RUNNING: 
                  console.log('Upload is running'); 
                  break; 
              } 
          }, function(error) {console.log(error); 
          }, function() { 
  
               // get the uploaded image url back 
               uploadTask.snapshot.ref.getDownloadURL().then( 
                function(downloadURL) { 
  
               // You get your url from here 
                console.log('File available at', downloadURL); 
  
              // print the image url  
			   console.log(downloadURL); 
			   var docRef = db.collection("Products").doc(localStorage.getItem("Productsss"));
										
										docRef.get().then(function(doc){
											var imgnam = doc.data().Product_Img;
											var desertRef = storageRef.child('images/'+ imgnam);
											desertRef.delete().then(function() {
												


  
											}).catch(function(error) {
  
											});

											db.collection("Products").doc(Pname.replace(/\s/g,'')).set({
        								Product_Name: document.getElementById("product").value,
        								Product_Category:  document.getElementById("select").value,
        								Product_Discription: document.getElementById("textarea1").value,
        								Product_Quantity:  document.getElementById("qty").value,
										Product_Unit: document.getElementById("unit").value,
										Product_Price: document.getElementById("price").value,
										Product_Img: name,
										CheckPointQuantity1: document.getElementById("qty-req1").value,
										CheckPointPrice1: document.getElementById("price-point1").value,
										CheckPointQuantity2: document.getElementById("qty-req2").value,
										CheckPointPrice2: document.getElementById("price-point2").value,
										CheckPointQuantity3: document.getElementById("qty-req3").value,
										CheckPointPrice3: document.getElementById("price-point3").value,
										CheckPointQuantity4: document.getElementById("qty-req4").value,
										CheckPointPrice4: document.getElementById("price-point4").value,
										CheckPointQuantity5: document.getElementById("qty-req5").value,
										CheckPointPrice5: document.getElementById("price-point5").value,
										Product_URL: downloadURL,
										End_Date:$('#end-date').val(),
        						    	Checkbox_Show: checkvalue

    								})
    								.then(function() {
									alert("Document successfully written!");
									$(".main").show();
						 			$(".preview").hide();
									$("body").css("background-color","#f4e4a9");
									window.location.href = "ViewProducts.html";
									
    								})
    								.catch(function(error) {
        							alert("Error writing document: ");
								
									});
									
									
			   
										if(Pname.replace(/\s/g,'') != localStorage.getItem("Productsss"))
												{

										
												db.collection("Products").doc(localStorage.getItem("Productsss")).delete().then(function() {
													console.log("Document successfully deleted!");
												}).catch(function(error) {
												console.error("Error removing document: ", error);
											});

						}
										});
			  
			});

		
			
									
									
			 
        }); 
    };

								}
	

								
								
																
								
								
								
						
								
						 		
								
								 
						 	});
						});
		</script>
	</div>		
	<script>
		$( document ).ready(function(){

    		$('select').formSelect();

		    M.updateTextFields();

			$('#textarea1').val();
  			M.textareaAutoResize($('#textarea1'));

    		$('.sidenav').sidenav();

    		$('.materialboxed').materialbox();

    		$('.datepicker').datepicker({
    			format: 'dd-mm-yyyy'
    		});

  		});	
	</script>
	


<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-storage.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
	https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-analytics.js"></script>

<script>
// Your web app's Firebase configuration
var firebaseConfig = {
	apiKey: "AIzaSyBNuyR1kYlUE47dRdvSwH_ktun0aJdmnIw",
	authDomain: "codellion-project.firebaseapp.com",
	databaseURL: "https://codellion-project.firebaseio.com",
	projectId: "codellion-project",
	storageBucket: "codellion-project.appspot.com",
	messagingSenderId: "115691137424",
	appId: "1:115691137424:web:6512ab76b92862f9302b15",
	measurementId: "G-QDVW8S0KLN"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
firebase.analytics();
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script> 
<script src="UpdateProduct.js"></script>
</body>
</html>